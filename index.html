<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Happy Birthday üéâüíê</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#ff84b7">
  <style>
    :root {
      --bg1: #fff0f6;
      --bg2: #e9f7ff;
      --ink: #202024;
      --primary: #ff4da6;
      --accent: #6a5cff;
      --card: rgba(255,255,255,0.72);
      --shadow: 0 10px 30px rgba(0,0,0,0.12);
      --radius: 18px;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: system-ui, -apple-system, ui-sans-serif, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: radial-gradient(1200px 800px at 20% 20%, var(--bg1), transparent 70%),
                  radial-gradient(1200px 800px at 80% 80%, var(--bg2), transparent 70%),
                  linear-gradient(180deg, #fff, #fff);
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card {
      width: min(720px, 100%);
      border-radius: var(--radius);
      background: var(--card);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      padding: 28px 22px;
    }
    .inner {
      border-radius: calc(var(--radius) - 6px);
      padding: 28px 20px;
      background: #fff;
      position: relative;
      overflow: hidden;
    }
    h1 {
      margin: 0 0 8px;
      font-size: clamp(28px, 6vw, 44px);
      line-height: 1.1;
      letter-spacing: -0.02em;
    }
    .subtitle {
      opacity: 0.75;
      margin-bottom: 18px;
      font-size: clamp(14px, 2.8vw, 18px);
    }
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    button {
      appearance: none;
      border: 0;
      border-radius: 999px;
      padding: 12px 16px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(90deg, var(--primary), #ff9b4d);
      color: #fff;
      box-shadow: 0 6px 16px rgba(255,77,166,0.35);
      transition: transform 0.06s ease;
    }
    button:active { transform: translateY(1px) scale(0.98); }
    .outline {
      background: #f2f2ff;
      color: #3a2fff;
      box-shadow: none;
    }
    .bouquet-wrap {
      display: grid;
      place-items: center;
      margin: 10px 0 0;
      min-height: 260px;
      position: relative;
    }
    .closed-envelope {
      width: min(340px, 80vw);
      aspect-ratio: 4/3;
      border-radius: 18px;
      background:
        linear-gradient(180deg, #ffe1ee, #ffd1e6) padding-box,
        linear-gradient(180deg, #fff, #fff) border-box;
      border: 2px solid #ffb6d6;
      display: grid;
      place-items: center;
      box-shadow: var(--shadow);
      transition: transform 0.6s cubic-bezier(.2,.8,.2,1), opacity .3s ease;
    }
    .closed-envelope .tap {
      font-weight: 700;
      color: #ff2e86;
      font-size: clamp(16px, 4vw, 20px);
    }
    .bouquet {
      width: min(520px, 96%);
      max-width: 520px;
      opacity: 0;
      transform: translateY(20px) scale(.98);
      transition: transform .7s cubic-bezier(.2,.9,.2,1), opacity .6s ease;
      filter: drop-shadow(0 14px 24px rgba(0,0,0,0.12));
      pointer-events: none;
    }
    .open .closed-envelope { opacity: 0; transform: translateY(-10px) scale(.94); pointer-events: none; }
    .open .bouquet { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
    .footer {
      margin-top: 14px;
      font-size: 13px;
      opacity: .65;
      text-align: center;
    }
    /* small ‚Äúmade for‚Äù tag */
    .tag {
      position: absolute; top: 12px; right: 12px;
      background: #0000000d; padding: 6px 10px; border-radius: 999px; font-size: 12px;
    }
    /* make buttons comfy on iOS */
    @supports (padding: max(0px)) {
      .card { padding-bottom: max(22px, env(safe-area-inset-bottom)); }
    }
    canvas#confetti {
      position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;
    }
    /* Accessibility: reduce motion */
    @media (prefers-reduced-motion: reduce) {
      .closed-envelope, .bouquet { transition: none; }
      canvas#confetti { display: none; }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="inner" id="cardInner" aria-live="polite">
      <div class="tag" id="madeFor"></div>
      <h1 id="title">Happy Birthday! üéÇ</h1>
      <div class="subtitle" id="subtitle">Tap the button to open your bouquet.</div>

      <div class="controls">
        <button id="openBtn">Open bouquet üíê</button>
        <button class="outline" id="switchBtn" aria-pressed="false">Switch to tulips üå∑</button>
        <button class="outline" id="shareBtn">Share</button>
      </div>

      <div class="bouquet-wrap" id="bouquetWrap">
        <div class="closed-envelope" id="envelope" role="button" tabindex="0" aria-label="Open bouquet">
          <div class="tap">Tap to open üíù</div>
        </div>

        <!-- Bouquet SVGs -->
        <svg class="bouquet" id="bouquet-lilies" viewBox="0 0 520 520" aria-label="Lilies bouquet" role="img">
          <defs>
            <linearGradient id="wrapGrad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#ffd1e6"/>
              <stop offset="1" stop-color="#ffc7f1"/>
            </linearGradient>
            <linearGradient id="stemGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0" stop-color="#53c36b"/>
              <stop offset="1" stop-color="#2c9e54"/>
            </linearGradient>
            <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#000" flood-opacity="0.15"/>
            </filter>
          </defs>
          <!-- wrapper -->
          <g filter="url(#softShadow)">
            <path d="M260 480c-80 0-150-50-168-120l70-80h196l70 80c-18 70-88 120-168 120z" fill="url(#wrapGrad)" stroke="#ff9acb" stroke-width="2" />
            <circle cx="260" cy="350" r="14" fill="#ff4da6"/>
          </g>
          <!-- stems -->
          <g stroke="url(#stemGrad)" stroke-width="6" stroke-linecap="round" fill="none">
            <path d="M260 350 C 240 300, 220 250, 210 200" />
            <path d="M260 350 C 280 300, 300 250, 310 200" />
            <path d="M260 350 C 260 300, 260 250, 260 200" />
          </g>
          <!-- lilies (stylized) -->
          <g transform="translate(200,160)">
            <g transform="translate(0,0) scale(1.2)">
              <path d="M40 40 C 20 0, 60 0, 40 40 Z" fill="#fff6f6" stroke="#f0c9d8"/>
              <path d="M40 40 C 0 20, 0 60, 40 40 Z" fill="#fff" stroke="#f0c9d8"/>
              <path d="M40 40 C 80 20, 80 60, 40 40 Z" fill="#fff" stroke="#f0c9d8"/>
              <circle cx="40" cy="40" r="4" fill="#f4a2c6"/>
              <g stroke="#f4a2c6" stroke-width="2"><line x1="40" y1="40" x2="40" y2="22"/><line x1="40" y1="40" x2="26" y2="30"/><line x1="40" y1="40" x2="54" y2="30"/></g>
            </g>
          </g>
          <g transform="translate(130,185) scale(0.95)">
            <path d="M40 40 C 20 0, 60 0, 40 40 Z" fill="#fff6f6" stroke="#f0c9d8"/>
            <path d="M40 40 C 0 20, 0 60, 40 40 Z" fill="#fff" stroke="#f0c9d8"/>
            <path d="M40 40 C 80 20, 80 60, 40 40 Z" fill="#fff" stroke="#f0c9d8"/>
            <circle cx="40" cy="40" r="4" fill="#f4a2c6"/>
            <g stroke="#f4a2c6" stroke-width="2"><line x1="40" y1="40" x2="40" y2="22"/><line x1="40" y1="40" x2="26" y2="30"/><line x1="40" y1="40" x2="54" y2="30"/></g>
          </g>
          <g transform="translate(260,180) scale(1.05)">
            <path d="M40 40 C 20 0, 60 0, 40 40 Z" fill="#fff6f6" stroke="#f0c9d8"/>
            <path d="M40 40 C 0 20, 0 60, 40 40 Z" fill="#fff" stroke="#f0c9d8"/>
            <path d="M40 40 C 80 20, 80 60, 40 40 Z" fill="#fff" stroke="#f0c9d8"/>
            <circle cx="40" cy="40" r="4" fill="#f4a2c6"/>
            <g stroke="#f4a2c6" stroke-width="2"><line x1="40" y1="40" x2="40" y2="22"/><line x1="40" y1="40" x2="26" y2="30"/><line x1="40" y1="40" x2="54" y2="30"/></g>
          </g>
          <!-- leaves -->
          <g fill="#b6f2c6" opacity="0.9">
            <ellipse cx="210" cy="300" rx="32" ry="16" transform="rotate(-20 210 300)"/>
            <ellipse cx="310" cy="300" rx="32" ry="16" transform="rotate(20 310 300)"/>
          </g>
        </svg>

        <svg class="bouquet" id="bouquet-tulips" viewBox="0 0 520 520" aria-label="Tulips bouquet" role="img">
          <defs>
            <linearGradient id="wrapGrad2" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#ffe6b8"/>
              <stop offset="1" stop-color="#ffd7a8"/>
            </linearGradient>
            <linearGradient id="stemGrad2" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0" stop-color="#3ccf7a"/>
              <stop offset="1" stop-color="#269a5a"/>
            </linearGradient>
            <filter id="softShadow2" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#000" flood-opacity="0.15"/>
            </filter>
          </defs>
          <g filter="url(#softShadow2)">
            <path d="M260 480c-80 0-150-50-168-120l70-80h196l70 80c-18 70-88 120-168 120z" fill="url(#wrapGrad2)" stroke="#ffc27a" stroke-width="2" />
            <circle cx="260" cy="350" r="14" fill="#ff8a00"/>
          </g>
          <!-- stems -->
          <g stroke="url(#stemGrad2)" stroke-width="6" stroke-linecap="round" fill="none">
            <path d="M260 350 C 220 300, 220 250, 200 200" />
            <path d="M260 350 C 260 300, 260 250, 260 200" />
            <path d="M260 350 C 300 300, 300 250, 320 200" />
          </g>
          <!-- tulips -->
          <g transform="translate(180,170)">
            <path d="M40 80 C 20 60, 15 30, 40 30 C 65 30, 60 60, 40 80 Z" fill="#ff5d8f" stroke="#e54a7c"/>
            <path d="M40 30 l8 10 l-8 8 l-8 -8 Z" fill="#ff8fb0"/>
          </g>
          <g transform="translate(240,170) scale(1.05)">
            <path d="M40 80 C 20 60, 15 30, 40 30 C 65 30, 60 60, 40 80 Z" fill="#ff4da6" stroke="#e23b94"/>
            <path d="M40 30 l8 10 l-8 8 l-8 -8 Z" fill="#ffa4c2"/>
          </g>
          <g transform="translate(300,170) scale(0.95)">
            <path d="M40 80 C 20 60, 15 30, 40 30 C 65 30, 60 60, 40 80 Z" fill="#ff7b3d" stroke="#f2672a"/>
            <path d="M40 30 l8 10 l-8 8 l-8 -8 Z" fill="#ffb38a"/>
          </g>
          <!-- leaves -->
          <g fill="#a2efbf" opacity="0.9">
            <ellipse cx="210" cy="300" rx="32" ry="16" transform="rotate(-20 210 300)"/>
            <ellipse cx="310" cy="300" rx="32" ry="16" transform="rotate(20 310 300)"/>
          </g>
        </svg>

        <canvas id="confetti" aria-hidden="true"></canvas>
      </div>

      <div class="footer">
        Tip: add a name in the link like <code>?name=Aisha&flower=tulips</code> to personalize it.
      </div>
    </div>
  </div>

  <script>
    // Helpers
    const qs = new URLSearchParams(location.search);
    const name = (qs.get('name') || '').trim();
    const defaultFlower = (qs.get('flower') || '').toLowerCase();

    const title = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    const madeFor = document.getElementById('madeFor');
    const bouquetWrap = document.getElementById('bouquetWrap');
    const inner = document.getElementById('cardInner');
    const openBtn = document.getElementById('openBtn');
    const switchBtn = document.getElementById('switchBtn');
    const shareBtn = document.getElementById('shareBtn');
    const envelope = document.getElementById('envelope');
    const lilies = document.getElementById('bouquet-lilies');
    const tulips = document.getElementById('bouquet-tulips');
    const confetti = document.getElementById('confetti');
    const ctx = confetti.getContext('2d');

    let current = (defaultFlower === 'tulip' || defaultFlower === 'tulips') ? 'tulips'
               : (defaultFlower === 'lily' || defaultFlower === 'lilies') ? 'lilies'
               : (Math.random() < 0.5 ? 'lilies' : 'tulips');

    function setName(n) {
      if (n) {
        title.textContent = `Happy Birthday, ${n}! üéÇ`;
        madeFor.textContent = `Made for ${n}`;
      } else {
        title.textContent = `Happy Birthday! üéÇ`;
        madeFor.textContent = ``;
      }
    }
    setName(name);

    function show(type) {
      if (type === 'lilies') {
        lilies.style.display = 'block';
        tulips.style.display = 'none';
        switchBtn.textContent = 'Switch to tulips üå∑';
        switchBtn.setAttribute('aria-pressed', 'false');
      } else {
        tulips.style.display = 'block';
        lilies.style.display = 'none';
        switchBtn.textContent = 'Switch to lilies ‚ú®';
        switchBtn.setAttribute('aria-pressed', 'true');
      }
      current = type;
    }
    show(current);

    // Open action
    function openBouquet() {
      inner.classList.add('open');
      burstConfetti();
      subtitle.textContent = 'Hope this makes you smile üíñ';
    }
    openBtn.addEventListener('click', openBouquet, {passive:true});
    envelope.addEventListener('click', openBouquet, {passive:true});
    envelope.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openBouquet(); } });

    // Switch flowers
    switchBtn.addEventListener('click', () => {
      show(current === 'lilies' ? 'tulips' : 'lilies');
      // gentle confetti sprinkle on switch
      burstConfetti(60);
    }, {passive:true});

    // Share
    shareBtn.addEventListener('click', async () => {
      try {
        const url = new URL(location.href);
        if (name) url.searchParams.set('name', name);
        url.searchParams.set('flower', current);
        if (navigator.share) {
          await navigator.share({ title: 'Happy Birthday üíê', text: 'A bouquet for you!', url: url.toString() });
        } else {
          await navigator.clipboard.writeText(url.toString());
          shareBtn.textContent = 'Link copied ‚úÖ';
          setTimeout(()=> shareBtn.textContent = 'Share', 1600);
        }
      } catch(e) {
        console.log(e);
      }
    });

    // Confetti
    let W, H, particles = [], animId = null, running = false, endsAt = 0;
    function resize() { W = confetti.width = bouquetWrap.clientWidth; H = confetti.height = Math.max(280, bouquetWrap.clientHeight); }
    window.addEventListener('resize', resize, {passive:true});
    resize();

    function burstConfetti(count=120) {
      const now = performance.now();
      endsAt = now + 1500; // 1.5s run
      particles = [];
      for (let i=0;i<count;i++) {
        const angle = Math.random()*Math.PI - Math.PI/2; // upward spread
        const speed = 6 + Math.random()*6;
        particles.push({
          x: W/2, y: H/2,
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed - 2,
          g: 0.18 + Math.random()*0.12,
          size: 4 + Math.random()*6,
          rot: Math.random()*Math.PI,
          vr: (Math.random()-0.5)*0.3,
          shape: Math.random()<0.5 ? 'rect' : 'circle',
          color: pick(['#ff4da6','#ff8a00','#6a5cff','#00c2ff','#2ee6a6','#ffd400'])
        });
      }
      if (!running) { running = true; loop(); }
    }
    function pick(arr){ return arr[(Math.random()*arr.length)|0]; }

    function loop() {
      animId = requestAnimationFrame(loop);
      const now = performance.now();
      ctx.clearRect(0,0,W,H);
      for (const p of particles) {
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        drawParticle(p);
      }
      particles = particles.filter(p => p.y < H+20 && p.x > -20 && p.x < W+20);
      if (now > endsAt && particles.length === 0) {
        cancelAnimationFrame(animId);
        running = false;
      }
    }

    function drawParticle(p) {
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      if (p.shape === 'rect') {
        ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
      } else {
        ctx.beginPath();
        ctx.arc(0,0,p.size/2,0,Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
    }

    // Prevent iOS overscroll glow inside the card
    document.addEventListener('touchmove', (e) => {
      if (e.target.closest('.card')) e.preventDefault();
    }, {passive:false});
  </script>
</body>
</html>
